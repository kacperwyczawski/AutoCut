@using AutoCut.Frontend.Stores.Settings
@using System.Globalization
@inherits FluxorComponent
@inject IState<SettingsState> SettingsState
@inject ILogger<CultureUpdater> Logger
@inject NavigationManager NavigationManager

@code
{
    protected override void OnInitialized()
    {
        Logger.LogInformation("culture updater initialized");

        if (Equals(CultureInfo.DefaultThreadCurrentCulture, SettingsState.Value.Culture))
        {
            Logger.LogInformation("current culture is already {0}, returning",
                CultureInfo.DefaultThreadCurrentCulture.Name);
            return;
        }

        if (CultureInfo.DefaultThreadCurrentCulture is null)
        {
            Logger.LogInformation("current culture is null, returning");
            return;
        }

        Logger.LogInformation("initializing culture updater with culture {0}...",
            SettingsState.Value.Culture);

        CultureInfo.DefaultThreadCurrentCulture = SettingsState.Value.Culture;
        CultureInfo.DefaultThreadCurrentUICulture = SettingsState.Value.Culture;

        Logger.LogInformation("culture updated. current culture is {0}",
            CultureInfo.DefaultThreadCurrentCulture.Name);
        Logger.LogInformation("reloading page...");

        NavigationManager.NavigateTo(NavigationManager.Uri,
            true);

        Logger.LogInformation("page reloaded");
    }
}